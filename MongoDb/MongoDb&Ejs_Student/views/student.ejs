<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Table</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
      color: black;
      margin-bottom: 15px;
    }
    form {
      margin-bottom: 20px;
    }
    input, select {
      padding: 5px;
      margin-top: 5px;
    }
    button, a.action-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
    }
    button.add, button.filter {
      background-color: #007bff;
    }
    button.delete {
      background-color: red;
    }
    a.edit {
      background-color: rgb(40, 167, 69);
      text-decoration: none;
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
      color: white;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid black;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
<form action="/add-student" method="post">
  <label for="name">Enter Name:</label>
  <input type="text" id="name" name="name" placeholder="Enter name" required><br><br>
  <label for="section">Enter Section:</label>
  <input type="text" id="section" name="section" placeholder="Enter section" required><br><br>
  <label for="marks">Enter Marks:</label>
  <input type="number" id="marks" name="marks" placeholder="Enter marks" required>
  <button type="submit" class="add">Add Student</button>
</form>

<form action="/filter" method="get">
  <label for="condition">Condition:</label>
  <select name="condition" id="condition">
    <option value="gt" <%= condition === 'gt' ? 'selected' : '' %>>Greater Than</option>
    <option value="lt" <%= condition === 'lt' ? 'selected' : '' %>>Smaller Than</option>
    <option value="eq" <%= condition === 'eq' ? 'selected' : '' %>>Equal To</option>
  </select>
  <label for="marks">Marks:</label>
  <input type="number" name="marks" id="marks" placeholder="Enter marks" value="<%= marks ? marks : '' %>">
  <button type="submit" class="filter">Filter</button>
</form>

<h1>Student Table</h1>
<table>
  <tr>
    <th>Name</th>
    <th>Section</th>
    <th>Marks</th>
    <th>Action</th>
  </tr>
  <% students.forEach(student => { %>
    <tr>
      <td><%= student.name %></td>
      <td><%= student.section %></td>
      <td><%= student.marks %></td>
      <td>
        <button id="<%= student._id %>" onclick="delStudent(event)" class="delete">Delete</button>
        <a href="/update/<%= student._id %>" class="edit">Edit</a>
      </td>
    </tr>
  <% }) %>
</table>

<div style="text-align:center; margin-top:20px;">
  <% let prevPage = currentPage - 1; %>
  <% let nextPage = currentPage + 1; %>

  <button 
    <% if(prevPage < 1){ %>
      disabled style="background-color:#c0c0c0;color:white;border-radius:4px;cursor:not-allowed;"
    <% } else { %>
      onclick="window.location.href='?page=<%= prevPage %>'" style="background-color:#007bff;color:white;border-radius:4px;"
    <% } %>
  >Prev</button>

  <span style="margin:0 10px;">Page <%= currentPage %> of <%= totalPages %></span>

  <button 
    <% if(nextPage > totalPages){ %>
      disabled style="background-color:#c0c0c0;color:white;border-radius:4px;cursor:not-allowed;"
    <% } else { %>
      onclick="window.location.href='?page=<%= nextPage %>'" style="background-color:#007bff;color:white;border-radius:4px;"
    <% } %>
  >Next</button>
</div>

<script>
  function delStudent(event) {
    fetch(`/delete/${event.target.id}`, { method: "DELETE", redirect: "follow" })
    .then(resp => window.location.href = resp.url);
  }
</script>
</body>
</html>
